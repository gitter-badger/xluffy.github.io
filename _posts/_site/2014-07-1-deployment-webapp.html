<p>Bài viết dựa trên slide của tác giả, kèm thêm một số nhận định và kinh nghiệm cá nhân</p>

<h4 id="tng_quan">Tổng quan</h4>

<p>Deploy là hành vi đưa phần mềm, ứng dụng, website, tính năng, phiên bản tới cho user có thể sử dụng.</p>

<p>Đối với software deployment khá tương đồng với khái niệm release, đặc điểm của software deployment là thời gian để đưa ra một phiên bản khá là dài, 1 tuần, 1 tháng hoặc lâu hơn.</p>

<p>Đối với webapp deployment là đưa source code mới lên, cập nhật tính năng. Với PHP code, thì việc deploy chỉ là đưa các thay đổi của source code lên chứ không phải là đưa tất cả source lên thay thế code cũ.</p>

<h4 id="mc_tiu">Mục tiêu</h4>

<ul>
<li>One-click/Continuous deploys</li>

<li>Anytime/AnyWhere</li>

<li>AnyOne</li>

<li>Đáng tin cậy</li>

<li>Có khả năng rollback</li>

<li>No-downtime</li>

<li>Tái sử dụng</li>

<li>Có khả năng mở rộng</li>
</ul>

<h4 id="phng_thc">Phương thức</h4>

<ul>
<li>Vim-style</li>

<li>FTP Upload</li>

<li>Rsync (daemon, over ssh)</li>

<li>Source control (svn, git)</li>

<li>Build tools (ant, phing)</li>

<li>Specialize tools (fabric, Capistrano)</li>
</ul>

<h5 id="first_time">First Time</h5>

<ul>
<li>Copy file lên server (một hoặc nhiều)</li>

<li>Cấu hình phía server (connect DB, memcache)</li>

<li>Load DB</li>

<li>Install Assets (vendor, images)</li>

<li>Warm up cache</li>

<li>Enable Site</li>
</ul>

<h5 id="subscene_time">Sub-scene time</h5>

<ul>
<li>Copy file lên server</li>

<li>Apply DB update (migrations)</li>

<li>Install Assets (vendor, images)</li>

<li>Warm up cache</li>

<li>Enable Site</li>
</ul>

<h4 id="deployment_challenge">Deployment: Challenge</h4>

<p>Challenge: Nhanh và đáng tin cậy trong việc copy file</p>

<p>Solutions:</p>

<ul>
<li>rsync</li>

<li>git pull</li>
</ul>

<p>Challenge: Scalable</p>

<p>Solutions:</p>

<ul>
<li>Sử dụng tools cho phép đẩy đồng thời lên 1 hoặc nhiều server-node (fabric)</li>

<li>pssh cho phép gửi command tới đồng thời nhiều server (parallel)</li>
</ul>

<p>Challenge: Roll-back</p>

<p>Solutions:</p>

<ul>
<li>Test!</li>

<li>Sử dụng tag để releases</li>

<li>Delicate branches (master cho production)</li>

<li>Deploy mỗi phiên bản release trong một thư mục riêng</li>
</ul>

<p>Challenge: Secure</p>

<p>Solutions:</p>

<ul>
<li>Sử dụng ssh</li>

<li>Không lưu trữ password trong source control</li>

<li>Lưu trữ các biến nhạy cảm (password) ở biến môi trường trên server.</li>
</ul>

<p>Challenge: DB Migration</p>

<p>Solutions:</p>

<p>Challenge: Static asset</p>

<p>Solutions:</p>

<ul>
<li>Dùng YUICompress để thu nhỏ kích thước các file CSS, JS</li>

<li>Bật gzip trên webserver</li>

<li>Add version cho các links static (product?v=1)</li>

<li>Gộp nhiều file static vào làm một</li>

<li>Chạy các thao tác nén, gộp trên deploy env hoặc staging env rồi mới deploy</li>
</ul>

<p>Challenge: Caching</p>

<p>Solutions:</p>

<p>Challenge: File permission conflict</p>

<p>Solutions:</p>

<ul>
<li>Chạy nginx/php chung một user</li>

<li>PHP-FPM thay cho mod_php</li>

<li>…</li>
</ul>